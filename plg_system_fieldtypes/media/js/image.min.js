(function(a){a(document).ready(function(){a("[data-input-image]").each(function(){let field=a(this),id=field.attr("id"),form=field.find(".form"),input=form.find('input[type="file"]'),loading=form.find(".loading"),image=form.find("img");let params=Joomla.getOptions(id,""),folder_field=a("#"+params.folder_field),folder=a(folder_field).val(),ajax_url=params.ajax_url.replace(/&amp;/g,"&");if(params.folder_field===""||folder_field.length===0||folder===""){a(field).remove()}else{setInterval(function(){a(form).height(Math.round((a(field).width()/4)*3))},10);b()}input.on("change",function(d){if(!form.hasClass("disable")){c(d.target.files)}});field.on("drag dragstart dragend dragover dragenter dragleave drop",function(d){d.preventDefault();d.stopPropagation()}).on("dragover dragenter",function(){if(!form.hasClass("disable")){form.addClass("dragend")}}).on("dragleave dragend drop",function(){if(!form.hasClass("disable")){form.removeClass("dragend")}}).on("drop",function(d){if(!form.hasClass("disable")){c(d.originalEvent.dataTransfer.files)}});function c(d){let ajaxData=new FormData();ajaxData.append("task","images.uploadImage");ajaxData.append("folder",folder);ajaxData.append("filename",params.filename);ajaxData.append("noimage",params.noimage);ajaxData.append("files[]",d[0]);a.ajax({type:"POST",dataType:"json",url:ajax_url,processData:false,contentType:false,cache:false,global:false,async:false,data:ajaxData,beforeSend:function(){a(loading).show()},complete:function(){a(loading).hide()},success:function(e){if(e.success){a(image).attr("src",params.site_root+e.data)}else{console.error(e.message)}},error:function(e){console.error(e.status+": "+e.statusText)}})}function b(){a.ajax({type:"POST",dataType:"json",url:ajax_url,cache:false,global:false,async:false,data:{task:"images.getImage",folder:folder,filename:params.filename,noimage:params.noimage},beforeSend:function(){a(loading).show()},complete:function(){a(loading).hide()},success:function(d){if(d.success){a(image).attr("src",params.site_root+d.data)}else{console.error(d.message)}},error:function(d){console.error(d.status+": "+d.statusText)}})}a(form).find("a.refresh").on("click",function(){b()});a(form).find("a.remove").on("click",function(){a.ajax({type:"POST",dataType:"json",url:ajax_url,cache:false,global:false,async:false,data:{task:"images.deleteImage",folder:folder,filename:params.filename,noimage:params.noimage},beforeSend:function(){a(loading).show()},complete:function(){a(loading).hide()},success:function(d){if(d.success){a(image).attr("src",params.site_root+d.data)}else{console.error(d.message)}},error:function(d){console.error(d.status+": "+d.statusText)}})})})})})(jQuery);