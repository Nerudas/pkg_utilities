(function(a){a(document).ready(function(){a("[data-input-image-line]").each(function(){let field=a(this),id=field.attr("id"),form=field.find(".form"),input=form.find('input[type="file"]'),image=form.find("img"),value=form.find(".value");let params=Joomla.getOptions(id,""),folder_field=a("#"+params.folder_field),folder=a(folder_field).val(),ajax_url=params.ajax_url.replace(/&amp;/g,"&");if(params.folder_field===""||folder_field.length===0||folder===""){a(field).remove()}else{b()}input.on("change",function(d){if(!form.hasClass("disable")){c(d.target.files)}});function c(d){let ajaxData=new FormData();ajaxData.append("task","images.uploadImage");ajaxData.append("folder",folder);ajaxData.append("filename",params.filename);ajaxData.append("noimage",params.noimage);ajaxData.append("files[]",d[0]);a.ajax({type:"POST",dataType:"json",url:ajax_url,processData:false,contentType:false,cache:false,global:false,async:false,data:ajaxData,beforeSend:function(){a(form).addClass("disable")},complete:function(){a(form).removeClass("disable")},success:function(e){if(e.success){if(e.data!==params.noimage){a(image).attr("src",params.site_root+e.data);a(value).val(e.data)}else{a(image).attr("src","");a(value).val("")}}else{console.error(e.message)}},error:function(e){console.error(e.status+": "+e.statusText)}})}function b(){a.ajax({type:"POST",dataType:"json",url:ajax_url,cache:false,global:false,async:false,data:{task:"images.getImage",folder:folder,filename:params.filename,noimage:params.noimage},beforeSend:function(){a(form).addClass("disable")},complete:function(){a(form).removeClass("disable")},success:function(d){if(d.success){if(d.data!==params.noimage){a(image).attr("src",params.site_root+d.data);a(value).val(d.data)}else{a(image).attr("src","");a(value).val("")}}else{console.error(d.message)}},error:function(d){console.error(d.status+": "+d.statusText)}})}a(form).find("a.refresh").on("click",function(){b()});a(form).find("a.remove").on("click",function(){a.ajax({type:"POST",dataType:"json",url:ajax_url,cache:false,global:false,async:false,data:{task:"images.deleteImage",folder:folder,filename:params.filename,noimage:params.noimage},beforeSend:function(){a(form).addClass("disable")},complete:function(){a(form).removeClass("disable")},success:function(d){if(d.success){if(d.data!==params.noimage){a(image).attr("src",params.site_root+d.data);a(value).val(d.data)}else{a(image).attr("src","");a(value).val("")}}else{console.error(d.message)}},error:function(d){console.error(d.status+": "+d.statusText)}})})})})})(jQuery);